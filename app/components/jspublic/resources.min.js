!function(){"use strict";angular.module("ApiModule",[]).factory("ApiService",["$http","$window",function($http,$window){var _httpClient=$http;return{getToken:function(username,password){var data={username:username,password:password};return _httpClient.post("/v1/user-login",data)},register:function(username,password,name){var data={name:name,username:username,password:password,categories:[],favorites:[]};return _httpClient.post("/v1/register",data)},searchGiphies:function(searchTerm){var req={method:"POST",url:"/v1/search-giphies",headers:{authtoken:$window.sessionStorage.token||""},data:{term:searchTerm}};return _httpClient(req)},getAccount:function(){var req={method:"GET",url:"/v1/account",headers:{authtoken:$window.sessionStorage.token||""}};return _httpClient(req)},addToFavorites:function(favorites){var req={method:"PUT",url:"/v1/favorites",headers:{authtoken:$window.sessionStorage.token||""},data:{favorites:favorites}};return _httpClient(req)},addNewCategory:function(categories){var req={method:"PUT",url:"/v1/categories",headers:{authtoken:$window.sessionStorage.token||""},data:{categories:categories}};return _httpClient(req)}}}])}(),function(){"use strict";angular.module("appMainModule",["ngRoute","ui.bootstrap","ApiModule"]).controller("AppController",["$rootScope","$scope","ApiService","$location","$window",function($rootScope,$scope,apiService,$location,$window){function validateLoginInput(input){return!!/^[a-zA-Z0-9]+$/.test(input)}function setup(){$scope.showMobile=!1,$scope.username=void 0,$scope.usernameMandatory=!1,$scope.password=void 0,$scope.passwordMandatory=!1,$scope.name=void 0,$scope.nameMandatory=!1,$scope.isLogin=!0,$scope.registerSuccess=!1,$scope.searchResults=[]}$rootScope.inSession=!!$window.sessionStorage.token,$rootScope.inSession&&apiService.getAccount().then(function(response){$scope.categories=response.data.categories,$scope.favorites=response.data.favorites},function(error){401==error.status&&$scope.signOut()}),setup(),$scope.submitLogin=function(){$scope.isLogin||$scope.name&&validateLoginInput($scope.name)?$scope.username&&validateLoginInput($scope.username)?$scope.password&&validateLoginInput($scope.password)?$scope.isLogin?apiService.getToken($scope.username,$scope.password).then(function(response){$window.sessionStorage.token=response.data.token,$location.path("/")},function(error){401==error.status&&(setup(),$scope.usernameMandatory=!0,$scope.passwordMandatory=!0)}):apiService.register($scope.username,$scope.password,$scope.name).then(function(response){setup(),$scope.registerSuccess=!0},function(error){setup(),$scope.usernameMandatory=!0,$scope.isLogin=!1}):$scope.passwordMandatory=!0:$scope.usernameMandatory=!0:$scope.nameMandatory=!0},$scope.signOut=function(){delete $window.sessionStorage.token,$location.path("/login")},$scope.searchGiphies=function(term){return apiService.searchGiphies(term).then(function(response){$scope.searchResults=[],response.data.data.forEach(function(item){$scope.searchResults.push(item.embed_url)})},function(error){401==error.status&&$scope.signOut()})},$scope.addToFavorites=function(category,giphy){var favObject={};favObject[category]=giphy,$scope.favorites.includes(favObject)||($scope.favorites.push(favObject),apiService.addToFavorites($scope.favorites).then(function(response){},function(error){401==error.status&&$scope.signOut()}))},$scope.loadFavorites=function(category){$scope.searchResults=[],$scope.favorites.forEach(function(item){Object.keys(item)[0]==category&&$scope.searchResults.push(item[category])})},$scope.addNewCategory=function(categoryName){categoryName&&!$scope.categories.includes(categoryName)&&($scope.categories.push(categoryName),$scope.categoryName="",apiService.addNewCategory($scope.categories).then(function(response){},function(error){401==error.status&&$scope.signOut()}))}}]).config(function($routeProvider,$locationProvider){$routeProvider.when("/login",{controller:"AppController",templateUrl:"./components/routes/login.html"}).when("/",{controller:"AppController",templateUrl:"./components/routes/userpage.html"}).otherwise({redirectTo:"/login"}),$locationProvider.html5Mode({enabled:!0,requireBase:!1})}).config(function($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self","https://giphy.com/embed/**"])}).run(function($location,$window){if($window.sessionStorage.token)$location.path("/");else{for(var urls=["questions-and-answers"],i=0;i<urls.length;i++)if($window.location.href.toLowerCase().includes(urls[i]))return;$location.path("/login")}})}();